function C = q2mat(Q) % quaternion to rotation matrix conversion
 C = zeros(3,3);
 C(1,1) = Q(1)*Q(1) + Q(2)*Q(2) - Q(3)*Q(3) - Q(4)*Q(4);
 C(2,1) = 2.0*Q(2)*Q(3) + 2.0*Q(1)*Q(4);
 C(3,1) = 2.0*Q(2)*Q(4) - 2.0*Q(1)*Q(3);
 
 C(1,2) = 2.0*Q(2)*Q(3) - 2.0*Q(1)*Q(4);
 C(2,2) = Q(1)*Q(1) + Q(3)*Q(3) - Q(2)*Q(2) - Q(4)*Q(4);
 C(3,2) = 2.0*Q(1)*Q(2) + 2.0*Q(3)*Q(4);
 
 C(1,3) = 2.0*Q(1)*Q(3) + 2.0*Q(2)*Q(4);
 C(2,3) = 2.0*Q(3)*Q(4) - 2.0*Q(1)*Q(2);
 C(3,3) = Q(1)*Q(1) + Q(4)*Q(4) - Q(3)*Q(3) - Q(2)*Q(2);
